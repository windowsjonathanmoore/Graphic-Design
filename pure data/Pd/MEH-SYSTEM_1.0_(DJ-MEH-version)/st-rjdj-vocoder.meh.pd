#N canvas 155 100 1093 521 12;
#X obj -32 112 inlet~;
#X obj -135 179 outlet~;
#X obj 46 178 outlet~;
#X obj 148 114 inlet~;
#N canvas 1 120 565 454 hann-window 0;
#X obj 378 165 osc~;
#X obj 378 190 *~ -0.5;
#X obj 378 214 +~ 0.5;
#X obj 331 247 tabwrite~ \$0-hann;
#X obj 38 173 /;
#X obj 127 142 samplerate~;
#X obj 177 204 swap;
#X obj 177 228 /;
#X obj 49 201 * 1000;
#X obj 38 115 t f b f;
#X msg 173 92 resize \$1;
#X obj 173 116 s \$0-hann;
#X msg 382 130 0;
#X obj 330 131 t f b;
#X text 15 8 calculate Hann window table (variable window size) and
constants window-hz (fundamental frequency of analysis) \, window-sec
and window-msec (analysis window size in seconds and msec).;
#X obj 330 274 table \$0-hann 1024;
#X obj 49 228 s \$0-window-msec;
#X obj 38 251 s \$0-window-sec;
#X obj 38 88 r \$0-window-size;
#X obj 177 252 s \$0-window-hz;
#X obj 330 105 r \$0-window-hz;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 4 0 8 0;
#X connect 4 0 17 0;
#X connect 5 0 4 1;
#X connect 5 0 6 1;
#X connect 6 0 7 0;
#X connect 6 1 7 1;
#X connect 7 0 19 0;
#X connect 8 0 16 0;
#X connect 9 0 4 0;
#X connect 9 0 6 0;
#X connect 9 1 5 0;
#X connect 9 2 10 0;
#X connect 10 0 11 0;
#X connect 12 0 0 1;
#X connect 13 0 0 0;
#X connect 13 1 3 0;
#X connect 13 1 12 0;
#X connect 18 0 9 0;
#X connect 20 0 13 0;
#X restore 238 115 pd hann-window;
#X obj 236 -47 loadbang;
#X floatatom 9 39 5 0 0 0 - - -;
#X msg 236 -24 1024;
#X obj 236 -2 s \$0-window-size;
#X obj 252 -93 inlet;
#X obj 263 188 outlet;
#N canvas 409 72 450 300 pre-chord 0;
#X msg 3 145 52 55 59 62;
#X msg 3 167 50 53 57 60;
#X msg 3 123 57 60 64 67;
#N canvas 560 253 660 424 chord 0;
#X obj 92 147 -~ 0.5;
#X obj 92 196 clip~ -0.5 0.5;
#X obj 92 219 cos~;
#X obj 91 302 hip~ 5;
#X obj 91 365 outlet~;
#X obj 92 172 *~ 3;
#X obj 92 124 phasor~ 220;
#X obj 221 147 -~ 0.5;
#X obj 221 196 clip~ -0.5 0.5;
#X obj 221 219 cos~;
#X obj 221 172 *~ 3;
#X obj 356 150 -~ 0.5;
#X obj 356 199 clip~ -0.5 0.5;
#X obj 356 222 cos~;
#X obj 356 175 *~ 3;
#X obj 221 124 phasor~ 251;
#X obj 356 127 phasor~ 281;
#X obj 91 335 *~ 0.2;
#X msg 430 76 0;
#X obj 92 29 inlet;
#X text 204 32 test sound;
#X obj 92 79 mtof;
#X obj 132 81 mtof;
#X obj 168 82 mtof;
#X floatatom 237 50 5 0 0 0 - - -;
#X obj 465 153 -~ 0.5;
#X obj 465 202 clip~ -0.5 0.5;
#X obj 465 225 cos~;
#X obj 465 178 *~ 3;
#X obj 465 130 phasor~ 281;
#X obj 92 52 unpack 0 0 0 0;
#X obj 210 81 mtof;
#X connect 0 0 5 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 17 0;
#X connect 5 0 1 0;
#X connect 6 0 0 0;
#X connect 7 0 10 0;
#X connect 8 0 9 0;
#X connect 9 0 3 0;
#X connect 10 0 8 0;
#X connect 11 0 14 0;
#X connect 12 0 13 0;
#X connect 13 0 3 0;
#X connect 14 0 12 0;
#X connect 15 0 7 0;
#X connect 16 0 11 0;
#X connect 17 0 4 0;
#X connect 18 0 16 1;
#X connect 18 0 15 1;
#X connect 18 0 6 1;
#X connect 18 0 29 1;
#X connect 19 0 30 0;
#X connect 21 0 6 0;
#X connect 22 0 15 0;
#X connect 23 0 16 0;
#X connect 24 0 23 0;
#X connect 25 0 28 0;
#X connect 26 0 27 0;
#X connect 27 0 3 0;
#X connect 28 0 26 0;
#X connect 29 0 25 0;
#X connect 30 0 21 0;
#X connect 30 1 22 0;
#X connect 30 2 23 0;
#X connect 30 3 31 0;
#X connect 31 0 29 0;
#X restore 36 215 pd chord;
#X obj 12 41 int;
#X obj 12 89 route 0 1 2;
#X obj 12 14 lin-eq-conv 0 1 0 2.9;
#X obj 12 65 change;
#X obj 36 257 outlet~;
#X floatatom 177 78 5 0 0 0 - - -;
#X obj 12 -13 inlet;
#X connect 0 0 3 0;
#X connect 1 0 3 0;
#X connect 2 0 3 0;
#X connect 3 0 8 0;
#X connect 4 0 7 0;
#X connect 5 0 2 0;
#X connect 5 1 0 0;
#X connect 5 2 1 0;
#X connect 6 0 4 0;
#X connect 7 0 5 0;
#X connect 7 0 9 0;
#X connect 10 0 6 0;
#X restore -134 -73 pd pre-chord;
#N canvas 131 70 795 617 fft-analysis 0;
#X obj 94 511 *~;
#X obj 55 511 *~;
#X obj 413 356 *~;
#X obj 372 356 *~;
#X obj 372 379 +~;
#X obj 54 183 *~;
#X obj 54 158 inlet~;
#X obj 54 206 rfft~;
#X obj 54 560 *~;
#X obj 141 245 *~;
#X obj 372 333 rfft~;
#X obj 54 535 rifft~;
#X obj 54 583 outlet~;
#X obj 107 245 *~;
#X obj 107 268 +~;
#X text 458 408 modulus;
#X obj 107 420 *~;
#X obj 600 13 block~ 1024 4;
#X obj 107 398 clip~;
#X obj 87 184 tabreceive~ \$0-hann;
#X obj 107 294 +~ 1e-20;
#X obj 108 480 *~ 0.00065;
#X obj 87 560 tabreceive~ \$0-hann;
#X obj 373 307 *~;
#X obj 373 282 inlet~;
#X obj 406 308 tabreceive~ \$0-hann;
#X obj 107 321 q8_rsqrt~;
#X obj 372 402 q8_sqrt~;
#X text 458 425 of control;
#X text 456 442 amplitude;
#X text 196 248 reciprocal;
#X text 199 267 modulus of;
#X text 195 287 filter input;
#X text 196 306 amplitude;
#X text 115 159 filter input;
#X text 438 282 control source;
#X text 434 332 Fourier transform;
#X text 28 17 Internal workings of the timbre stamping algorithm. First
the "filter input" is treated as in the compressor patch \, multiplying
each channel amplitude by one over its modulus (but limited by the
"squelch" parameter.) It is then multiplied by the modulus of the channel
amplitude for the control source (which is Fourier analyzed in parallel
with the filter input.);
#X text 145 422 multiply the two amplitude;
#X text 143 439 factors (for compression;
#X text 145 455 and to apply new timbre);
#X obj 170 388 *;
#X obj 170 366 t a a;
#X obj 170 409 * 0.01;
#X obj 233 335 inlet squelch;
#X connect 0 0 11 1;
#X connect 1 0 11 0;
#X connect 2 0 4 1;
#X connect 3 0 4 0;
#X connect 4 0 27 0;
#X connect 5 0 7 0;
#X connect 6 0 5 0;
#X connect 7 0 13 0;
#X connect 7 0 13 1;
#X connect 7 0 1 0;
#X connect 7 1 9 0;
#X connect 7 1 9 1;
#X connect 7 1 0 0;
#X connect 8 0 12 0;
#X connect 9 0 14 1;
#X connect 10 0 3 0;
#X connect 10 0 3 1;
#X connect 10 1 2 0;
#X connect 10 1 2 1;
#X connect 11 0 8 0;
#X connect 13 0 14 0;
#X connect 14 0 20 0;
#X connect 16 0 21 0;
#X connect 18 0 16 0;
#X connect 19 0 5 1;
#X connect 20 0 26 0;
#X connect 21 0 0 1;
#X connect 21 0 1 1;
#X connect 22 0 8 1;
#X connect 23 0 10 0;
#X connect 24 0 23 0;
#X connect 25 0 23 1;
#X connect 26 0 18 0;
#X connect 27 0 16 1;
#X connect 41 0 43 0;
#X connect 42 0 41 0;
#X connect 42 1 41 1;
#X connect 43 0 18 2;
#X connect 44 0 42 0;
#X restore -134 150 pd fft-analysis;
#X text 401 75 inlets: <filter input~> <control source~> <methods>
;
#X text 386 -92 e_vocoder / timbre stamp;
#X text 390 -57 This is a Fourier-based "vocoder" (perhaps better called
a "timbre stamp") like the one the Convolution brothers use. The "control
source" is analyzed to get its spectral envelope \, which is then stamped
onto the "filter input" by adjusting the amplitudes of its Fourier
transform. The "filter input" is first whitened. The best value of
"squelch" to use depends critically on what kind of sounds are used
for the filter input and the control source.;
#X text 391 -134 e_vocoder from rjdj lib:https://trac.rjdj.me/wiki/WikiStart
;
#N canvas 133 68 795 617 fft-analysis 0;
#X obj 94 511 *~;
#X obj 55 511 *~;
#X obj 413 356 *~;
#X obj 372 356 *~;
#X obj 372 379 +~;
#X obj 54 183 *~;
#X obj 54 158 inlet~;
#X obj 54 206 rfft~;
#X obj 54 560 *~;
#X obj 141 245 *~;
#X obj 372 333 rfft~;
#X obj 54 535 rifft~;
#X obj 54 583 outlet~;
#X obj 107 245 *~;
#X obj 107 268 +~;
#X text 458 408 modulus;
#X obj 107 420 *~;
#X obj 600 13 block~ 1024 4;
#X obj 107 398 clip~;
#X obj 87 184 tabreceive~ \$0-hann;
#X obj 107 294 +~ 1e-20;
#X obj 108 480 *~ 0.00065;
#X obj 87 560 tabreceive~ \$0-hann;
#X obj 373 307 *~;
#X obj 373 282 inlet~;
#X obj 406 308 tabreceive~ \$0-hann;
#X obj 107 321 q8_rsqrt~;
#X obj 372 402 q8_sqrt~;
#X text 458 425 of control;
#X text 456 442 amplitude;
#X text 196 248 reciprocal;
#X text 199 267 modulus of;
#X text 195 287 filter input;
#X text 196 306 amplitude;
#X text 115 159 filter input;
#X text 438 282 control source;
#X text 434 332 Fourier transform;
#X text 28 17 Internal workings of the timbre stamping algorithm. First
the "filter input" is treated as in the compressor patch \, multiplying
each channel amplitude by one over its modulus (but limited by the
"squelch" parameter.) It is then multiplied by the modulus of the channel
amplitude for the control source (which is Fourier analyzed in parallel
with the filter input.);
#X text 145 422 multiply the two amplitude;
#X text 143 439 factors (for compression;
#X text 145 455 and to apply new timbre);
#X obj 170 388 *;
#X obj 170 366 t a a;
#X obj 170 409 * 0.01;
#X obj 233 335 inlet squelch;
#X connect 0 0 11 1;
#X connect 1 0 11 0;
#X connect 2 0 4 1;
#X connect 3 0 4 0;
#X connect 4 0 27 0;
#X connect 5 0 7 0;
#X connect 6 0 5 0;
#X connect 7 0 13 0;
#X connect 7 0 13 1;
#X connect 7 0 1 0;
#X connect 7 1 9 0;
#X connect 7 1 9 1;
#X connect 7 1 0 0;
#X connect 8 0 12 0;
#X connect 9 0 14 1;
#X connect 10 0 3 0;
#X connect 10 0 3 1;
#X connect 10 1 2 0;
#X connect 10 1 2 1;
#X connect 11 0 8 0;
#X connect 13 0 14 0;
#X connect 14 0 20 0;
#X connect 16 0 21 0;
#X connect 18 0 16 0;
#X connect 19 0 5 1;
#X connect 20 0 26 0;
#X connect 21 0 0 1;
#X connect 21 0 1 1;
#X connect 22 0 8 1;
#X connect 23 0 10 0;
#X connect 24 0 23 0;
#X connect 25 0 23 1;
#X connect 26 0 18 0;
#X connect 27 0 16 1;
#X connect 41 0 43 0;
#X connect 42 0 41 0;
#X connect 42 1 41 1;
#X connect 43 0 18 2;
#X connect 44 0 42 0;
#X restore 45 145 pd fft-analysis;
#X msg 9 -27 30;
#X text 48 40 squelch;
#X connect 0 0 12 2;
#X connect 3 0 17 2;
#X connect 5 0 7 0;
#X connect 5 0 18 0;
#X connect 6 0 17 1;
#X connect 6 0 12 1;
#X connect 7 0 8 0;
#X connect 9 0 11 0;
#X connect 11 0 12 0;
#X connect 11 0 17 0;
#X connect 12 0 1 0;
#X connect 17 0 2 0;
#X connect 18 0 6 0;
#X coords 0 -1 1 1 180 65 1 0 0;
