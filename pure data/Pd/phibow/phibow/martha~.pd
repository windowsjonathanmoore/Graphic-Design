#N canvas 497 472 1179 654 10;
#X obj 236 19 inlet;
#X text 260 471 2) Do logic as laid out in pseudocode;
#X obj 236 91 t b b l;
#N canvas 769 555 539 381 logic 0;
#X obj 109 44 inlet;
#X obj 109 96 f;
#X obj 109 140 select -1 0 1;
#N canvas 245 375 855 403 case-minus-one 0;
#X obj 162 15 inlet;
#X obj 162 66 f;
#X obj 162 146 select -1 0 1;
#X text 380 277 Only do this in the case of startup \, since the first
frame of sigmund~ might actually have zeros (continuations) in it.
Need to start up new voices in those cases \, but not in cases where
we have zeros two frames in a row and yet no voice assignment for that
peak number.;
#X obj 193 39 r \$0-martha-cur-peak-idx;
#X obj 162 88 tabread \$0-martha-trackFlags;
#X obj 210 273 send-update-abs \$0;
#X obj 87 244 kill-old-abs \$0;
#X obj 302 221 start-new-abs \$0;
#X obj 210 308 start-new-abs \$0;
#X connect 0 0 1 0;
#X connect 1 0 5 0;
#X connect 2 1 6 0;
#X connect 2 2 8 0;
#X connect 4 0 1 1;
#X connect 5 0 2 0;
#X connect 6 0 9 0;
#X restore 31 304 pd case-minus-one;
#N canvas 109 249 537 436 case-zero 0;
#X obj 85 54 inlet;
#X obj 108 120 f;
#X obj 108 176 select -1 0 1;
#N canvas 481 412 471 289 kill-old-start-new 0;
#X obj 74 44 inlet;
#X obj 74 66 t b b;
#X obj 182 119 kill-old-abs \$0;
#X obj 32 177 start-new-abs \$0;
#X connect 0 0 1 0;
#X connect 1 0 3 0;
#X connect 1 1 2 0;
#X restore 231 233 pd kill-old-start-new;
#X text 141 299 Don't start a new voice if no voice seems to be assigned
for this continuing track.;
#X obj 139 93 r \$0-martha-cur-peak-idx;
#X obj 109 142 tabread \$0-martha-trackFlags;
#X obj 44 252 kill-old-abs \$0;
#X obj 154 268 send-update-abs \$0;
#X connect 0 0 1 0;
#X connect 1 0 6 0;
#X connect 2 0 7 0;
#X connect 2 1 8 0;
#X connect 2 2 3 0;
#X connect 5 0 1 1;
#X connect 6 0 2 0;
#X restore 216 300 pd case-zero;
#N canvas 405 298 490 432 case-one 0;
#X obj 85 54 inlet;
#X obj 85 107 f;
#X obj 85 163 select -1 0 1;
#N canvas 282 170 471 289 kill-old-start-new 0;
#X obj 74 44 inlet;
#X obj 74 66 t b b;
#X obj 169 147 kill-old-abs \$0;
#X obj 32 177 start-new-abs \$0;
#X connect 0 0 1 0;
#X connect 1 0 3 0;
#X connect 1 1 2 0;
#X restore 231 233 pd kill-old-start-new;
#X obj 116 80 r \$0-martha-cur-peak-idx;
#X obj 85 129 tabread \$0-martha-trackFlags;
#X obj 41 289 kill-old-abs \$0;
#X obj 160 280 send-update-abs \$0;
#X connect 0 0 1 0;
#X connect 1 0 5 0;
#X connect 2 0 6 0;
#X connect 2 1 7 0;
#X connect 2 2 3 0;
#X connect 4 0 1 1;
#X connect 5 0 2 0;
#X restore 359 273 pd case-one;
#X obj 140 69 r \$0-martha-cur-peak-idx;
#X obj 109 118 tabread \$0-martha-trackFlagsPrev;
#X connect 0 0 1 0;
#X connect 1 0 7 0;
#X connect 2 0 3 0;
#X connect 2 1 4 0;
#X connect 2 2 5 0;
#X connect 6 0 1 1;
#X connect 7 0 2 0;
#X restore 278 433 pd logic;
#X obj 12 249 f;
#X text 309 20 sigmund~'s output comes in batches of -npeak \, but
we process each 4-element list separately.;
#X text 88 223 3) copy current trackFlag into trackFlagsPrev for next
time;
#X obj 341 381 unpack f f f f;
#X obj 535 120 list split 1;
#N canvas 95 240 637 381 logic-storage 0;
#X text 286 71 Same as -npeak;
#X text 286 161 Same as number of voices;
#X text 286 191 Same as -npeak;
#X obj 65 71 table \$0-martha-trackFlags;
#X obj 65 101 table \$0-martha-trackFlagsPrev;
#X obj 65 161 table \$0-martha-voiceAssts;
#X obj 65 191 table \$0-martha-trackVoices;
#X restore 56 438 pd logic-storage;
#X obj 505 229 unpack f f f f;
#X obj 540 300 >=;
#X obj 391 145 t l l l;
#X text 744 209 1) Check if amp is over threshold. If not \, artificially
flag it as -1 so that it will get killed;
#X msg 684 491 -1;
#X obj 591 468 spigot;
#X obj 662 379 select 0;
#X obj 481 483 spigot;
#X text 763 33 \$1: sigmund~'s -npeaks value;
#X text 763 53 \$2: number of voices in the oscillator bank;
#N canvas 774 60 801 492 init 0;
#X obj 366 41 loadbang;
#X obj 366 63 t b b;
#X obj 366 132 f \$1;
#X obj 411 97 f \$2;
#X obj 445 246 t f b;
#N canvas 0 22 737 428 gen-voices 0;
#X obj 121 28 inlet;
#X obj 136 116 until;
#X obj 136 168 f;
#X obj 166 170 + 1;
#X msg 157 140 0;
#X obj 120 70 t b f b;
#X obj 136 190 t f f f;
#X obj 210 252 i;
#X obj 210 274 * 25;
#X obj 156 248 * 150;
#X obj 210 230 / 6;
#X obj 156 226 % 6;
#X obj 86 297 pack f f f \$0;
#X msg 86 327 \; pd-\$4-martha-oscillator-bank obj \$2 \$3 osc-bank-voice
\$1 \$4 \;;
#X connect 0 0 5 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 2 0 6 0;
#X connect 3 0 2 1;
#X connect 4 0 2 1;
#X connect 5 1 1 0;
#X connect 5 2 4 0;
#X connect 6 0 12 0;
#X connect 6 1 11 0;
#X connect 6 2 10 0;
#X connect 7 0 8 0;
#X connect 8 0 12 2;
#X connect 9 0 12 1;
#X connect 10 0 7 0;
#X connect 11 0 9 0;
#X connect 12 0 13 0;
#X restore 429 353 pd gen-voices;
#X msg 498 309 \; pd-\$1-martha-oscillator-bank clear \;;
#X obj 498 285 f \$0;
#X obj 58 161 pack f f \$0;
#X obj 58 101 r \$0-martha-num-peaks;
#X obj 445 224 r \$0-martha-num-voices;
#X obj 411 117 s \$0-martha-num-voices;
#X obj 366 152 s \$0-martha-num-peaks;
#X obj 103 131 r \$0-martha-num-voices;
#X msg 58 195 \; \$3-martha-trackFlags resize \$1 \; \$3-martha-trackFlagsPrev
resize \$1 \; \$3-martha-trackFlags const -1 \; \$3-martha-trackFlagsPrev
const -1 \; \; \$3-martha-voiceAssts resize \$2 \; \$3-martha-trackVoices
resize \$1 \; \$3-martha-voiceAssts const -1 \; \$3-martha-trackVoices
const -1 \; \$3-martha-voiceAssts bounds 0 \$1 \$2 -1 \; \$3-martha-trackVoices
bounds 0 \$2 \$1 -1 \;;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 1 1 3 0;
#X connect 2 0 12 0;
#X connect 3 0 11 0;
#X connect 4 0 5 0;
#X connect 4 1 7 0;
#X connect 7 0 6 0;
#X connect 8 0 14 0;
#X connect 9 0 8 0;
#X connect 10 0 4 0;
#X connect 13 0 8 1;
#X restore 56 418 pd init;
#X obj 54 591 outlet~;
#X obj 821 104 inlet;
#N canvas 128 127 1038 625 command-parsing 1;
#X obj 46 -35 inlet;
#X obj 46 23 list split 1;
#X obj 49 55 t b a;
#X obj 61 155 s;
#X obj 121 117 symbol;
#X obj 33 91 list;
#X obj 33 112 list trim;
#X obj 121 93 makefilename \$0-martha-%s;
#X obj 368 33 r \$0-martha-amp-thresh;
#X floatatom 368 55 10 0 0 0 - - -, f 10;
#X obj 538 33 r \$0-martha-attack-time-range;
#X floatatom 538 77 5 0 0 0 - - -, f 5;
#X floatatom 598 77 5 0 0 0 - - -, f 5;
#X obj 538 55 unpack f f;
#X floatatom 748 77 5 0 0 0 - - -, f 5;
#X floatatom 808 77 5 0 0 0 - - -, f 5;
#X obj 748 55 unpack f f;
#X obj 748 33 r \$0-martha-release-time-range;
#X floatatom 538 187 5 0 0 0 - - -, f 5;
#X floatatom 598 187 5 0 0 0 - - -, f 5;
#X obj 538 165 unpack f f;
#X floatatom 748 187 5 0 0 0 - - -, f 5;
#X floatatom 808 187 5 0 0 0 - - -, f 5;
#X obj 748 165 unpack f f;
#X obj 538 143 r \$0-martha-gliss-range;
#X obj 748 143 r \$0-martha-gliss-onset-delay-range;
#X floatatom 538 287 5 0 0 0 - - -, f 5;
#X floatatom 598 287 5 0 0 0 - - -, f 5;
#X obj 538 265 unpack f f;
#X floatatom 748 287 5 0 0 0 - - -, f 5;
#X floatatom 808 287 5 0 0 0 - - -, f 5;
#X obj 748 265 unpack f f;
#X obj 538 243 r \$0-martha-gliss-dur-range;
#X obj 748 243 r \$0-martha-tremolo-rate-range;
#X obj 368 143 r \$0-martha-dsp-switch;
#X obj 368 173 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 351 -93 loadbang;
#X msg 351 -63 amp-thresh 0.2 \, attack-time-range 5 10 \, release-time-range
250 500 \, gliss-range 0 0 \, gliss-onset-delay-range 50 750 \, gliss-dur-range
500 2000 \, tremolo-rate-range 0 0 \, dsp-switch 1;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 1 1 5 1;
#X connect 2 0 5 0;
#X connect 2 1 7 0;
#X connect 4 0 3 1;
#X connect 5 0 6 0;
#X connect 6 0 3 0;
#X connect 7 0 4 0;
#X connect 8 0 9 0;
#X connect 10 0 13 0;
#X connect 13 0 11 0;
#X connect 13 1 12 0;
#X connect 16 0 14 0;
#X connect 16 1 15 0;
#X connect 17 0 16 0;
#X connect 20 0 18 0;
#X connect 20 1 19 0;
#X connect 23 0 21 0;
#X connect 23 1 22 0;
#X connect 24 0 20 0;
#X connect 25 0 23 0;
#X connect 28 0 26 0;
#X connect 28 1 27 0;
#X connect 31 0 29 0;
#X connect 31 1 30 0;
#X connect 32 0 28 0;
#X connect 33 0 31 0;
#X connect 34 0 35 0;
#X connect 36 0 37 0;
#X connect 37 0 1 0;
#X restore 821 126 pd command-parsing;
#X obj 947 365 switch~;
#N canvas 857 45 830 420 pitchify-stuff 0;
#X obj 45 72 table \$0-martha-pitchify-switches;
#X obj 45 92 table \$0-martha-pitchify-pitches 8;
#X obj 45 132 table \$0-martha-transpo-values 8;
#X msg 368 121 \; \$2-martha-pitchify-switches resize \$1 \;;
#X obj 368 79 r \$0-martha-num-voices;
#X obj 368 100 pack f \$0;
#X obj 362 265 pack f \$0;
#X msg 362 287 \; \$2-martha-pitchify-switches const \$1 \;;
#X obj 362 213 r \$0-martha-pitch-switch;
#X obj 362 235 > 0;
#X obj 88 243 r \$0-martha-pitch-list;
#X obj 88 265 list prepend 0;
#X obj 88 287 s \$0-martha-pitchify-pitches;
#X connect 4 0 5 0;
#X connect 5 0 3 0;
#X connect 6 0 7 0;
#X connect 8 0 9 0;
#X connect 9 0 6 0;
#X connect 10 0 11 0;
#X connect 11 0 12 0;
#X restore 56 488 pd pitchify-stuff;
#X obj 36 191 r \$0-martha-cur-peak-idx;
#X obj 12 275 tabread \$0-martha-trackFlags;
#X obj 155 297 r \$0-martha-cur-peak-idx;
#X obj 12 326 tabwrite \$0-martha-trackFlagsPrev;
#X obj 535 143 s \$0-martha-cur-peak-idx;
#X obj 589 253 r \$0-martha-amp-thresh;
#X obj 540 324 s \$0-martha-amp-thresh-flag;
#X obj 947 333 r \$0-martha-dsp-switch;
#X obj 797 489 r \$0-martha-cur-peak-idx;
#X obj 621 543 tabwrite \$0-martha-trackFlags;
#X obj 481 513 s \$0-martha-cur-peak-amp;
#X obj 411 543 s \$0-martha-cur-peak-freq;
#X obj 646 346 r \$0-martha-amp-thresh-flag;
#X obj 54 561 catch~ \$0-martha-sum-bus;
#X msg 710 434 \; \$1-martha-cur-peak-amp 0 \;;
#X obj 710 414 f \$0;
#N canvas 103 57 966 596 \$0-martha-oscillator-bank 0;
#X obj 450 400 osc-bank-voice 99 3259;
#X obj 0 0 osc-bank-voice 0 3259;
#X obj 150 0 osc-bank-voice 1 3259;
#X obj 300 0 osc-bank-voice 2 3259;
#X obj 450 0 osc-bank-voice 3 3259;
#X obj 600 0 osc-bank-voice 4 3259;
#X obj 750 0 osc-bank-voice 5 3259;
#X obj 0 25 osc-bank-voice 6 3259;
#X obj 150 25 osc-bank-voice 7 3259;
#X obj 300 25 osc-bank-voice 8 3259;
#X obj 450 25 osc-bank-voice 9 3259;
#X obj 600 25 osc-bank-voice 10 3259;
#X obj 750 25 osc-bank-voice 11 3259;
#X obj 0 50 osc-bank-voice 12 3259;
#X obj 150 50 osc-bank-voice 13 3259;
#X obj 300 50 osc-bank-voice 14 3259;
#X obj 450 50 osc-bank-voice 15 3259;
#X obj 600 50 osc-bank-voice 16 3259;
#X obj 750 50 osc-bank-voice 17 3259;
#X obj 0 75 osc-bank-voice 18 3259;
#X obj 150 75 osc-bank-voice 19 3259;
#X obj 300 75 osc-bank-voice 20 3259;
#X obj 450 75 osc-bank-voice 21 3259;
#X obj 600 75 osc-bank-voice 22 3259;
#X obj 750 75 osc-bank-voice 23 3259;
#X obj 0 100 osc-bank-voice 24 3259;
#X obj 150 100 osc-bank-voice 25 3259;
#X obj 300 100 osc-bank-voice 26 3259;
#X obj 450 100 osc-bank-voice 27 3259;
#X obj 600 100 osc-bank-voice 28 3259;
#X obj 750 100 osc-bank-voice 29 3259;
#X obj 0 125 osc-bank-voice 30 3259;
#X obj 150 125 osc-bank-voice 31 3259;
#X obj 300 125 osc-bank-voice 32 3259;
#X obj 450 125 osc-bank-voice 33 3259;
#X obj 600 125 osc-bank-voice 34 3259;
#X obj 750 125 osc-bank-voice 35 3259;
#X obj 0 150 osc-bank-voice 36 3259;
#X obj 150 150 osc-bank-voice 37 3259;
#X obj 300 150 osc-bank-voice 38 3259;
#X obj 450 150 osc-bank-voice 39 3259;
#X obj 600 150 osc-bank-voice 40 3259;
#X obj 750 150 osc-bank-voice 41 3259;
#X obj 0 175 osc-bank-voice 42 3259;
#X obj 150 175 osc-bank-voice 43 3259;
#X obj 300 175 osc-bank-voice 44 3259;
#X obj 450 175 osc-bank-voice 45 3259;
#X obj 600 175 osc-bank-voice 46 3259;
#X obj 750 175 osc-bank-voice 47 3259;
#X obj 0 200 osc-bank-voice 48 3259;
#X obj 150 200 osc-bank-voice 49 3259;
#X obj 300 200 osc-bank-voice 50 3259;
#X obj 450 200 osc-bank-voice 51 3259;
#X obj 600 200 osc-bank-voice 52 3259;
#X obj 750 200 osc-bank-voice 53 3259;
#X obj 0 225 osc-bank-voice 54 3259;
#X obj 150 225 osc-bank-voice 55 3259;
#X obj 300 225 osc-bank-voice 56 3259;
#X obj 450 225 osc-bank-voice 57 3259;
#X obj 600 225 osc-bank-voice 58 3259;
#X obj 750 225 osc-bank-voice 59 3259;
#X obj 0 250 osc-bank-voice 60 3259;
#X obj 150 250 osc-bank-voice 61 3259;
#X obj 300 250 osc-bank-voice 62 3259;
#X obj 450 250 osc-bank-voice 63 3259;
#X obj 600 250 osc-bank-voice 64 3259;
#X obj 750 250 osc-bank-voice 65 3259;
#X obj 0 275 osc-bank-voice 66 3259;
#X obj 150 275 osc-bank-voice 67 3259;
#X obj 300 275 osc-bank-voice 68 3259;
#X obj 450 275 osc-bank-voice 69 3259;
#X obj 600 275 osc-bank-voice 70 3259;
#X obj 750 275 osc-bank-voice 71 3259;
#X obj 0 300 osc-bank-voice 72 3259;
#X obj 150 300 osc-bank-voice 73 3259;
#X obj 300 300 osc-bank-voice 74 3259;
#X obj 450 300 osc-bank-voice 75 3259;
#X obj 600 300 osc-bank-voice 76 3259;
#X obj 750 300 osc-bank-voice 77 3259;
#X obj 0 325 osc-bank-voice 78 3259;
#X obj 150 325 osc-bank-voice 79 3259;
#X obj 300 325 osc-bank-voice 80 3259;
#X obj 450 325 osc-bank-voice 81 3259;
#X obj 600 325 osc-bank-voice 82 3259;
#X obj 750 325 osc-bank-voice 83 3259;
#X obj 0 350 osc-bank-voice 84 3259;
#X obj 150 350 osc-bank-voice 85 3259;
#X obj 300 350 osc-bank-voice 86 3259;
#X obj 450 350 osc-bank-voice 87 3259;
#X obj 600 350 osc-bank-voice 88 3259;
#X obj 750 350 osc-bank-voice 89 3259;
#X obj 0 375 osc-bank-voice 90 3259;
#X obj 150 375 osc-bank-voice 91 3259;
#X obj 300 375 osc-bank-voice 92 3259;
#X obj 450 375 osc-bank-voice 93 3259;
#X obj 600 375 osc-bank-voice 94 3259;
#X obj 750 375 osc-bank-voice 95 3259;
#X obj 0 400 osc-bank-voice 96 3259;
#X obj 150 400 osc-bank-voice 97 3259;
#X obj 300 400 osc-bank-voice 98 3259;
#X restore 56 458 pd \$0-martha-oscillator-bank;
#X obj 589 274 / 100;
#X connect 0 0 2 0;
#X connect 2 0 4 0;
#X connect 2 1 3 0;
#X connect 2 2 12 0;
#X connect 4 0 27 0;
#X connect 7 1 37 0;
#X connect 7 2 17 0;
#X connect 7 3 15 0;
#X connect 8 0 30 0;
#X connect 10 2 11 0;
#X connect 11 0 32 0;
#X connect 12 0 7 0;
#X connect 12 1 10 0;
#X connect 12 2 8 0;
#X connect 14 0 35 0;
#X connect 15 0 35 0;
#X connect 16 0 14 0;
#X connect 16 0 41 0;
#X connect 17 0 36 0;
#X connect 22 0 23 0;
#X connect 26 0 4 1;
#X connect 27 0 29 0;
#X connect 28 0 29 1;
#X connect 31 0 43 0;
#X connect 33 0 24 0;
#X connect 34 0 35 1;
#X connect 38 0 15 1;
#X connect 38 0 16 0;
#X connect 38 0 17 1;
#X connect 39 0 21 0;
#X connect 41 0 40 0;
#X connect 43 0 11 1;
